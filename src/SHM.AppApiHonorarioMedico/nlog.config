<?xml version="1.0" encoding="utf-8" ?>
<nlog xmlns="http://www.nlog-project.org/schemas/NLog.xsd"
      xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
      autoReload="true"
      internalLogLevel="Info"
      internalLogFile="Logs/internal-nlog.txt">

  <!-- Habilitar ASP.NET Core layout renderers -->
  <extensions>
    <add assembly="NLog.Web.AspNetCore"/>
  </extensions>

  <!-- Variables -->
  <variable name="logDirectory" value="Logs"/>

  <!-- Targets: donde se escriben los logs -->
  <targets>

    <!-- Archivo de log diario - Todos los niveles -->
    <target xsi:type="File"
            name="allfile"
            fileName="${logDirectory}/nlog-all-${shortdate}.log"
            layout="${longdate}|${event-properties:item=EventId:whenEmpty=0}|${level:uppercase=true}|${logger}|${message} ${exception:format=tostring}"
            archiveFileName="${logDirectory}/archives/nlog-all-{#}.log"
            archiveEvery="Day"
            archiveNumbering="Date"
            archiveDateFormat="yyyy-MM-dd"
            maxArchiveFiles="30"
            concurrentWrites="true"
            keepFileOpen="false" />

    <!-- Archivo de log diario - Solo errores y superiores -->
    <target xsi:type="File"
            name="errorfile"
            fileName="${logDirectory}/nlog-errors-${shortdate}.log"
            layout="${longdate}|${event-properties:item=EventId:whenEmpty=0}|${level:uppercase=true}|${logger}|${message} ${exception:format=tostring}|url: ${aspnet-request-url}|action: ${aspnet-mvc-action}"
            archiveFileName="${logDirectory}/archives/nlog-errors-{#}.log"
            archiveEvery="Day"
            archiveNumbering="Date"
            archiveDateFormat="yyyy-MM-dd"
            maxArchiveFiles="30"
            concurrentWrites="true"
            keepFileOpen="false" />

    <!-- Archivo de log diario - Solo información de la aplicación -->
    <target xsi:type="File"
            name="appfile"
            fileName="${logDirectory}/nlog-app-${shortdate}.log"
            layout="${longdate}|${level:uppercase=true}|${logger}|${message} ${exception:format=tostring}"
            archiveFileName="${logDirectory}/archives/nlog-app-{#}.log"
            archiveEvery="Day"
            archiveNumbering="Date"
            archiveDateFormat="yyyy-MM-dd"
            maxArchiveFiles="30"
            concurrentWrites="true"
            keepFileOpen="false" />

    <!-- Console Target para desarrollo -->
    <target xsi:type="Console"
            name="console"
            layout="${longdate}|${level:uppercase=true}|${logger}|${message} ${exception:format=tostring}" />

  </targets>

  <!-- Reglas: qué se registra y dónde -->
  <rules>

    <!-- Todos los logs a archivo completo -->
    <logger name="*" minlevel="Trace" writeTo="allfile" />

    <!-- Logs de la aplicación (excluye Microsoft.*) -->
    <logger name="SHM.*" minlevel="Info" writeTo="appfile" />

    <!-- Solo errores y superiores a archivo de errores -->
    <logger name="*" minlevel="Error" writeTo="errorfile" />

    <!-- Logs a consola en desarrollo -->
    <logger name="*" minlevel="Info" writeTo="console" />

    <!-- Ignorar logs de Microsoft muy verbosos -->
    <logger name="Microsoft.Hosting.Lifetime" minlevel="Info" writeTo="console" final="true" />
    <logger name="Microsoft.*" maxlevel="Info" final="true" />
    <logger name="System.Net.Http.*" maxlevel="Info" final="true" />

  </rules>
</nlog>
